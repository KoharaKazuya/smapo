extends ../layout

block script
  script
    :coffee
      $ ->
        $('[data-toggle=popover]').popover()
      # display user info
      user_id = $.cookie('user_id')
      jQuery.ajax
        method: 'get'
        url: '/user/' + user_id
        success: (user) ->
          $ ->
            $('#user-icon-link').attr 'href', user.icon
            $('#user-icon-img').attr 'src', user.icon
            $('#username').text user.username
            for name in ['catchphrase', 'self_introduction']
              form_old_input name, user
        error: ->
          alert 'ユーザーデータを取得できません'
      $ ->
        $('.main-form').attr 'data-url', '/user/' + user_id

block content
  h2.page-header プロフィール変更

  .row
    .col-md-12.media.well
      a.pull-left#user-icon-link
        img.user-icon.media-object#user-icon-img
      .media-body
        h2.media-heading#username
  .row
    .col-md-12
      form.form-horizontal.main-form(action='javascript:void(0)', accept-charset='utf-8', data-method='put')
        input(type='hidden', name='_csrf', value='#{ _csrf }')
        .form-group
          label.col-md-3.control-label(for='catchphrase') キャッチフレーズ <span class="glyphicon glyphicon-question-sign" data-toggle="popover" data-placement="left" data-title="キャッチフレーズについて" data-content="プロフィールやユーザー一覧の名前の横などに表示されます (最大 100 文字まで)"></span>
          .col-md-9
            input.form-control#catchphrase(name='catchphrase', maxlength=100, placeholder='あなたを端的に表すと？')
        .form-group
          label.col-md-3.control-label(for='self_introduction') 自己紹介文
          .col-md-9
            textarea.form-control#self_introduction(name='self_introduction', maxlength=10000, rows=5, placeholder='自己紹介文には Markdown が利用できます')
        .form-group
          label.col-md-3.control-label(for='icon') アイコン画像 <span class="glyphicon glyphicon-question-sign" data-toggle="popover" data-placement="left" data-title="画像サイズについて" data-content="最大 64x64 にリサイズされます"></span>
          .col-md-9
            input.form-control#icon(type='file', name='icon')
        .form-group
          label.col-md-offset-3.col-md-9
            input.btn.btn-primary(type='submit', value='変更')
